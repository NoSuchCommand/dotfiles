- name: Bash configuration
  hosts: localhost
  connection: local
  gather_facts: no
  become: no
  tasks:

  - name: User facts
    setup:
      filter: '*user*'

  - name: User info
    set_fact:
      homedir: '{{ ansible_facts.user_dir }}'

  - name: Main .bashrc file
    copy:
      src: bashrc
      dest: '{{ homedir }}/.bashrc'
      mode: 0644

  - name: Top level .bashrc.d directory
    file:
      path: '{{ homedir }}/.bashrc.d'
      state: directory
      mode: 0700

  - name: Source files in .bashrc.d
    copy:
      src: '{{ item }}'
      dest: '{{ homedir }}/.bashrc.d/'
      mode: 0600
    with_fileglob: bashrc.d/*.sh
